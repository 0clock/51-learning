C51 COMPILER V9.60.7.0   USART                                                             04/21/2023 17:04:02 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN .\OBJ\usart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Library\src\usart.c LARGE OMF2 WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE 
                    -INCDIR(.\Library\inc;.\USER) PRINT(.\usart.lst) TABS(2) OBJECT(.\OBJ\usart.obj)

line level    source

   1          /*********************************************************************************************************
   2          ** ļ ͨس
   3          **  Blue Sky TeamsZZL
   4          ** ̰汾 V1.0
   5          *********************************************************************************************************/
   6          
   7          
   8          #include "usart.h"
   9          
  10          uchar data_length=0,flag=0; //ⲿ
  11          uchar data_buffer[10]={0};  //
  12          
  13          /*********************************************************************************************************
  14          **  ڳʼ
  15          ** ˵ SMODǵԴƼĴPCONbit7λ
  16          **        T1x12ǸĴAUXRеbit6λ
  17          **         ʵִãʼ㷽SMOD   T1x12 
  18          **                                                 0       0       FSCLK/32/12/(256-TH1)
  19          **                                                 0       1       FSCLK/32/(256-TH1) 
  20          **                                                 1       0       FSCLK*2/32/12(256-TH1)
  21          **                                                 1       1       FSCKL*2/32/(256-TH1)
  22          ** ڲ 
  23          ** ڲ  
  24          ** ϸĽοSTC12C5A60S2.pdfڰ пͨ
  25          *********************************************************************************************************/
  26          void USART_Init()
  27          {
  28   1        PCON |= 0x80;   //ʹܲʱλSMOD
  29   1        SCON = 0x50;    //8λ,ɱ䲨
  30   1      //  AUXR &= 0xBF;   //ʱ1ʱΪFosc/12,12T
  31   1      //  AUXR &= 0xFE;   //1ѡʱ1Ϊʷ
  32   1      //  TMOD &= 0x0F;   //ʱ1ģʽλ
  33   1        TMOD |= 0x20;   //趨ʱ1Ϊ8λԶװʽ
  34   1        TL1 = 0xFF;   //趨ʱֵ
  35   1        TH1 = 0xFF;   //趨ʱװֵ
  36   1        ET1 = 0;    //ֹʱ1ж
  37   1        TR1 = 1;    //ʱ1
  38   1        EA=1;
  39   1        
  40   1      //  PCON &= 0x7F;   //ʲ SMOD=0
  41   1      //  SCON = 0x50;    //Ϊʽ1,8λ,ɱ䲨,
  42   1      //  AUXR |= 0x40;   //ʱ1ʱΪFosc,1T
  43   1      //  TMOD = 0X20;    //ʱ1:ģʽ2,8λԶװģʽ,ڲ 
  44   1      //  TL1 = 0XD9;       //趨ʱֵΪ9600
  45   1      //  TH1 = 0XD9;       //趨ʱװֵ
  46   1      //  TR1 = 1;      //ʱ1
  47   1      //  ES = 1;       //ж
  48   1      //  EA = 1;       //ж
  49   1        //EAES1дڽջ߷ִͣджϷvoid USART_Interrupt(void)  interrupt 4   
  50   1      }   
  51          /*********************************************************************************************************
  52          **  һַ
  53          ** ڲ d͵ַ
  54          ** ڲ 
C51 COMPILER V9.60.7.0   USART                                                             04/21/2023 17:04:02 PAGE 2   

  55          *********************************************************************************************************/
  56          void Send_Byte(unsigned char c)
  57          {
  58   1        
  59   1        SBUF = c;
  60   1        while(!TI); //ɣTIԶ1ѭִн
  61   1        TI=0;   // ,TI㣬´η͵ʱӲſԽһΪжϷɵ
  62   1      }        
  63          /*********************************************************************************************************
  64          **  һȵַ
  65          ** ڲ strַĵַ
  66          **            lengthַĳ
  67          ** ڲ 
  68          *********************************************************************************************************/
  69          void Send_String(uchar *str ,uint length) 
  70          {
  71   1        while(length!=0)
  72   1        {
  73   2          Send_Byte(*str++) ;
  74   2          length --;
  75   2        }
  76   1      }
  77          
  78          /*********************************************************************************************************
  79          **  жϷ
  80          ** ڲ 
  81          ** ڲ 
  82          *********************************************************************************************************/
  83          void USART_Interrupt(void)  interrupt 4  
  84          {
  85   1        EA = 0; 
  86   1          if(RI)      //жRI(жϱ־)ǷΪ1
  87   1          {
  88   2            RI=0;
  89   2            data_buffer[data_length++] = SBUF;//յݴ뵽
  90   2          if(data_buffer[data_length-1] == '\n' || data_length == 10)flag = 1; //ܵس򻺳ݽ
             -λflag
  91   2          }
  92   1        EA = 1;
  93   1      }
  94          
  95          
  96          unsigned char Uart_Receive_Byte()//UART Receive a byteg
  97          { 
  98   1        unsigned char dat;
  99   1        while(!RI);  //Ϊ1 
 100   1        RI = 0;
 101   1        dat = SBUF;
 102   1        return (dat);
 103   1      }
 104          
 105          
 106          /************************** (C) COPYRIGHT 2011 Blue Sky Teams *****END OF FILE****************************
             -*/
 107          
 108          
 109          //RS485ͨѶʵ
 110          
 111          /*
 112            ʵ485˫ͨ
 113          Ӳӣ  3λŰ߷ֱJ9_0J17_ROJ9_1J17_DIԼJ9_2J17_RE,
 114                      1λŰ߽J11_0J7_S17,1λŰ߽J10_0J13_8,
C51 COMPILER V9.60.7.0   USART                                                             04/21/2023 17:04:02 PAGE 3   

 115                      װҰRS485ӿڵABӦAABBӡ
 116          */
 117          
 118          //sbit    RO     =P3^0;   //RO
 119          //sbit    DI     =P3^1;   //DI
 120          //sbit    RE     =P3^2;   //RE,ڷͽģʽѡ
 121          //
 122          //void main(void)
 123          //{
 124          // init_com( ) ;        //ʼ
 125          // while(1)
 126          // {
 127          //  if(KEY ==0 )        //жǷа
 128          //   { 
 129          //    delay(100);       //ʱ
 130          //    while(KEY ==0);   //ȴͷ
 131          //    RE = 1;           //485Ϊģʽ
 132          //    send_char(0xaa);  //1ֽ
 133          //   }
 134          //
 135          //  RE=0;               //485Ϊģʽ
 136          //  if (read_flag)      //ȡ־λʾнյ
 137          //    { 
 138          //      read_flag= 0 ;  //ȡ־0 
 139          //      if(ch==0xaa)    //ж485յǷȷ
 140          //       {LED=0;delay(5000);LED=1;} //ȷLED˸1
 141          //    } 
 142          // } 
 143          //}
 144          
 145          
 146          
 147          
 148           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
